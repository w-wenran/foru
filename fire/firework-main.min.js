function drawFPS(){
    delta=Date.now()-lastCalledTime, fps_count++,
    delta>1e3&&(delta=(Date.now()-lastCalledTime)/1e3,
        lastCalledTime=Date.now(),
        fps=fps_count,fps_count=0),
        ctx.save(),
        ctx.globalCompositeOperation="source-over",
        ctx.fillStyle="white",
        ctx.fillText("FPS: "+fps,20,40),ctx.restore()
}

function drawDecemberCafe(){
    ctx.fillStyle="white", ctx.fillText("Designed by DecemberCafe " + wsize[1],20,20)
}

function updateWindow(){
    w=window,d=document,
        e=d.documentElement,
        g=d.getElementsByTagName("body")[0],
        //x=e.clientWidth||w.innerWidth||g.clientWidth,y=e.clientHeight||w.innerHeight||g.clientHeight,
        //width=x<800?800:x,
        x=g.clientWidth,y=g.clientHeight
        width=x,
        //height=.7*y,
        height=y,
        canvas.setAttribute("width",width),canvas.setAttribute("height",height);
    return [width,height];
}

function fireStart() {
    setInterval(function(){
        ctx.save(), ctx.globalAlpha=.2,
            //ctx.fillStyle="black",
            //ctx.fillRect(0,0,wsize[0],wsize[1]),
            ctx.drawImage(backimg,0,0,1600,1067,0,0,wsize[0],wsize[1]),
            ctx.restore(),
            ctx.save(),
           // ctx.globalCompositeOperation="lighter",
        Math.random()<.1&&fireworks.length<50&&(fireworks.push(new Firework(ctx,wsize[0],wsize[1])),
            fireworks[fireworks.length-1].init(
                //position
                {x:50+Math.random()*(wsize[0]-50),y:90+(wsize[1]/10)*Math.random()},
                //color
                {h:Math.random(),s:1,l:.6+.3*Math.random()},
                700+1e3*Math.random(),//duration
                parseInt(21+10*Math.random()),//num
                3+2*Math.random()),//speed
            fireworks[fireworks.length-1].size=2+3*Math.random());

        for(var a=fireworks.length-1;a>=0;a--)
            fireworks[a].time < fireworks[a].duration?(fireworks[a].update(),fireworks[a].render()):fireworks.splice(a,1);

        ctx.restore();
        //drawDecemberCafe(),drawFPS()

    },37);
}


var canvas=document.getElementById("mycanvas"), ctx=canvas.getContext("2d"), width=1600,height=768;

ctx.fillStyle = 'rgba(255, 255, 255, 0)';

var wsize = updateWindow();

var backimg=new Image;

backimg.src="./fire/night-trees-stars.jpg";

var lastCalledTime=Date.now(), fps=100, delta=0, fps_count=0, time=0, fireworks=[];



    window.onresize=updateWindow;